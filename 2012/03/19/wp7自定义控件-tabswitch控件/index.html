<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>WP7自定义控件 TabSwitch控件 | Kiminozo&#39;s Tech Blog</title>
  <meta name="author" content="kiminozo">
  
  <meta name="description" content="关注Windows phone开发">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:title" content="WP7自定义控件 TabSwitch控件"/>
  <meta property="og:site_name" content="Kiminozo&#39;s Tech Blog"/>

  <link rel="alternate" href="/atom.xml" title="Kiminozo&#39;s Tech Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <div class="wrapper">
    <header id="header"><div class="title">
  <h1><a href="/">Kiminozo&#39;s Tech Blog</a></h1>
  <p><a href="/"></a></p>
</div>
<nav class="nav">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2012-03-19T01:41:00.000Z"><a href="/2012/03/19/wp7自定义控件-tabswitch控件/">3月 19 2012</a></time>
    
    
  
    <h1 class="title">WP7自定义控件 TabSwitch控件</h1>
  

  </header>
  
  <div class="entry">
    
      <p>我在写一个类似tabcontrol的选项控件，在很多网站的Menu的效果，不知道怎么取名字，暂时就叫TabSwitch吧。</p>
<p>效果如下：</p>
<object width="450" height="100" data="http://files.cnblogs.com/kiminozo/TabSwitch.xap" type="application/x-silverlight-2"><param name="source" value="http://files.cnblogs.com/kiminozo/TabSwitch.xap" /><param name="minRuntimeVersion" value="4.0.50826.0" /><param name="src" value="http://files.cnblogs.com/kiminozo/TabSwitch.xap" /></object>

<p>&nbsp;</p>
<h2 id="TabSwitch控件要点">TabSwitch控件要点</h2>
<ol>
<li>类似横排的单选框组，可以多个选项卡，只能选择一个。</li>
<li>可以点击其中一个选择一个选项，选中后背景图块移动到选中项，背景图块的刷子可以自定义</li>
<li>支持选中事件和选择项的绑定。</li>
<li>为了提高视觉效果，有一个动画过度。</li>
</ol>
<p>&nbsp;</p>
<h2 id="实现控件要点的方法描述">实现控件要点的方法描述</h2>
<p>1 继承ItemsControl控件可以容纳多个Item，并添加TabSwitchItem类</p>
<p>2 图块用一个Rectangle搞定，为了实现移动位置将RenderTransform设置为CompositeTransform。</p>
<p>3 添加一个Selected的event实现选中数据，添加多个SelectItem依赖属性实现绑定。</p>
<p>4 通过选中位置获取相对的X坐标，通过Item长度计算x所在的index，然后应用动画修改CompositeTransform的TranslateX，TranslateX位置设置为index*Item宽度。</p>
<p>5 DoubleAnimation+EasingFunction 的弹簧效果ElasticEase可以实现动画过度。</p>
<p>&nbsp;</p>
<h2 id="完整代码">完整代码</h2>
<p>&nbsp;</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('e72e318b-292a-4897-8d66-b0bd578bd94c')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""><span class="cnblogs_code_collapse">View Code </span><br><div id="cnblogs_code_open_e72e318b-292a-4897-8d66-b0bd578bd94c" class="cnblogs_code_hide"><br><pre><span style="color: #0000ff;">using</span> System;<br><span style="color: #0000ff;">using</span> System.Collections.Generic;<br><span style="color: #0000ff;">using</span> System.Linq;<br><span style="color: #0000ff;">using</span> System.Net;<br><span style="color: #0000ff;">using</span> System.Windows;<br><span style="color: #0000ff;">using</span> System.Windows.Controls;<br><span style="color: #0000ff;">using</span> System.Windows.Controls.Primitives;<br><span style="color: #0000ff;">using</span> System.Windows.Documents;<br><span style="color: #0000ff;">using</span> System.Windows.Input;<br><span style="color: #0000ff;">using</span> System.Windows.Media;<br><span style="color: #0000ff;">using</span> System.Windows.Media.Animation;<br><span style="color: #0000ff;">using</span> System.Windows.Shapes;<br><br><span style="color: #0000ff;">namespace</span> KiminozoStudio<br>{<br>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> TabSwitchItem : ContentControl<br>    {<br>        <span style="color: #0000ff;">public</span> TabSwitchItem()<br>        {<br>            <span style="color: #0000ff;">this</span>.DefaultStyleKey = <span style="color: #0000ff;">typeof</span>(TabSwitchItem);<br>        }<br>    }<br><br>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> TabSwitch : ItemsControl<br>    {<br>        <span style="color: #0000ff;">#region</span> Propertys<br><br>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">readonly</span> DependencyProperty SelectedWidthProperty =<br>            DependencyProperty.Register(<span style="color: #800000;">“</span><span style="color: #800000;">SelectedWidth</span><span style="color: #800000;">“</span>, <span style="color: #0000ff;">typeof</span>(<span style="color: #0000ff;">double</span>), <span style="color: #0000ff;">typeof</span>(TabSwitch),<br>                                        <span style="color: #0000ff;">new</span> PropertyMetadata(<span style="color: #800080;">65.0</span>, SelectedWidthPropertyChanged));<br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 选中项的宽度<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">double</span> SelectedWidth<br>        {<br>            <span style="color: #0000ff;">get</span> { <span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">double</span>)GetValue(SelectedWidthProperty); }<br>            <span style="color: #0000ff;">set</span> { SetValue(SelectedWidthProperty, value); }<br>        }<br><br>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">readonly</span> DependencyProperty SelectedItemProperty =<br>            DependencyProperty.Register(<span style="color: #800000;">“</span><span style="color: #800000;">SelectedItem</span><span style="color: #800000;">“</span>, <span style="color: #0000ff;">typeof</span>(TabSwitchItem), <span style="color: #0000ff;">typeof</span>(TabSwitch),<br>                                        <span style="color: #0000ff;">new</span> PropertyMetadata(<span style="color: #0000ff;">null</span>));<br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 选中的TabSwitchItem控件<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">public</span> TabSwitchItem SelectedItem<br>        {<br>            <span style="color: #0000ff;">get</span> { <span style="color: #0000ff;">return</span> (TabSwitchItem)GetValue(SelectedItemProperty); }<br>            <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">set</span> { SetValue(SelectedItemProperty, value); }<br>        }<br><br>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">readonly</span> DependencyProperty SelectedValueProperty =<br>            DependencyProperty.Register(<span style="color: #800000;">“</span><span style="color: #800000;">SelectedValue</span><span style="color: #800000;">“</span>, <span style="color: #0000ff;">typeof</span>(<span style="color: #0000ff;">object</span>), <span style="color: #0000ff;">typeof</span>(TabSwitch),<br>                                        <span style="color: #0000ff;">new</span> PropertyMetadata(<span style="color: #0000ff;">null</span>));<br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 选中项的内容值<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">object</span> SelectedValue<br>        {<br>            <span style="color: #0000ff;">get</span> { <span style="color: #0000ff;">return</span> GetValue(SelectedValueProperty); }<br>            <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">set</span> { SetValue(SelectedValueProperty, value); }<br>        }<br><br>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">readonly</span> DependencyProperty SelectedIndexProperty =<br>            DependencyProperty.Register(<span style="color: #800000;">“</span><span style="color: #800000;">SelectedIndex</span><span style="color: #800000;">“</span>, <span style="color: #0000ff;">typeof</span>(<span style="color: #0000ff;">int</span>), <span style="color: #0000ff;">typeof</span>(TabSwitch),<br>                                        <span style="color: #0000ff;">new</span> PropertyMetadata(<span style="color: #800080;">0</span>, SelectedIndexPropertyChanged));<br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 选中项的序号<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> SelectedIndex<br>        {<br>            <span style="color: #0000ff;">get</span> { <span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">int</span>)GetValue(SelectedIndexProperty); }<br>            <span style="color: #0000ff;">set</span> { SetValue(SelectedIndexProperty, value); }<br>        }<br><br>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">readonly</span> DependencyProperty SelectedBackgroundProperty =<br>            DependencyProperty.Register(<span style="color: #800000;">“</span><span style="color: #800000;">SelectedBackground</span><span style="color: #800000;">“</span>, <span style="color: #0000ff;">typeof</span>(Brush), <span style="color: #0000ff;">typeof</span>(TabSwitch),<br>                                        <span style="color: #0000ff;">new</span> PropertyMetadata(<span style="color: #0000ff;">new</span> SolidColorBrush(Colors.Red),<br>                                                             SelectedBackgroundPropertyChanged));<br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 选择项的背景刷子<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">public</span> Brush SelectedBackground<br>        {<br>            <span style="color: #0000ff;">get</span> { <span style="color: #0000ff;">return</span> (Brush)GetValue(SelectedBackgroundProperty); }<br>            <span style="color: #0000ff;">set</span> { SetValue(SelectedBackgroundProperty, value); }<br>        }<br><br>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> SelectedBackgroundPropertyChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)<br>        {<br>            <span style="color: #0000ff;">var</span> sender = o <span style="color: #0000ff;">as</span> TabSwitch;<br>            <span style="color: #0000ff;">if</span> (sender == <span style="color: #0000ff;">null</span> || e.NewValue == e.OldValue) <span style="color: #0000ff;">return</span>;<br>            sender.SetSelectedBackground(e.NewValue <span style="color: #0000ff;">as</span> Brush);<br>        }<br><br>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> SelectedIndexPropertyChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)<br>        {<br>            <span style="color: #0000ff;">var</span> sender = o <span style="color: #0000ff;">as</span> TabSwitch;<br>            <span style="color: #0000ff;">if</span> (sender == <span style="color: #0000ff;">null</span> || e.NewValue == e.OldValue) <span style="color: #0000ff;">return</span>;<br><br>            sender.SetSelectedIndex((<span style="color: #0000ff;">int</span>)e.NewValue);<br>        }<br><br>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> SelectedWidthPropertyChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)<br>        {<br>            <span style="color: #0000ff;">var</span> sender = o <span style="color: #0000ff;">as</span> TabSwitch;<br>            <span style="color: #0000ff;">if</span> (sender == <span style="color: #0000ff;">null</span> || e.NewValue == e.OldValue) <span style="color: #0000ff;">return</span>;<br><br>            sender.SetSelectedWidth((<span style="color: #0000ff;">double</span>)e.NewValue);<br>        }<br>        <span style="color: #0000ff;">#endregion</span><br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 背景的方形<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">private</span> Rectangle rectangle;<br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 选中事件<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">event</span> RoutedEventHandler Selected;<br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 触发选中事件<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”e”&gt;&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> OnSelected(RoutedEventArgs e)<br>        {<br>            RoutedEventHandler handler = Selected;<br>            <span style="color: #0000ff;">if</span> (handler != <span style="color: #0000ff;">null</span>) handler(<span style="color: #0000ff;">this</span>, e);<br>        }<br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 改变选中项<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”index”&gt;</span><span style="color: #008000;">索引序号</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> ChangeSelected(<span style="color: #0000ff;">int</span> index)<br>        {<br>            <span style="color: #0000ff;">if</span> (index &lt; <span style="color: #800080;">0</span> || index &gt; Items.Count) <span style="color: #0000ff;">return</span>;<br>            ;<br>            SelectedIndex = index;<br>            <span style="color: #0000ff;">var</span> switchItem = Items[index] <span style="color: #0000ff;">as</span> TabSwitchItem;<br>            <span style="color: #0000ff;">if</span> (switchItem != <span style="color: #0000ff;">null</span>)<br>            {<br>                SelectedItem = switchItem;<br>                SelectedValue = switchItem.Content;<br>            }<br>            <span style="color: #0000ff;">else</span><br>            {<br>                SelectedValue = Items[index];<br>            }<br>            OnSelected(<span style="color: #0000ff;">new</span> RoutedEventArgs());<br>        }<br><br>        <span style="color: #0000ff;">public</span> TabSwitch()<br>        {<br>            DefaultStyleKey = <span style="color: #0000ff;">typeof</span>(TabSwitch);<br>        }<br><br>        <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> OnApplyTemplate()<br>        {<br>            <span style="color: #0000ff;">base</span>.OnApplyTemplate();<br>            rectangle = (Rectangle)GetTemplateChild(<span style="color: #800000;">“</span><span style="color: #800000;">rectangle</span><span style="color: #800000;">“</span>);<br>            SetSelectedBackground(SelectedBackground);<br>            SetSelectedWidth(SelectedWidth);<br>            SetSelectedIndex(SelectedIndex);<br>        }<br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 设置选中背景的宽度<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”itemWidth”&gt;&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> SetSelectedWidth(<span style="color: #0000ff;">double</span> itemWidth)<br>        {<br>            <span style="color: #0000ff;">if</span> (rectangle == <span style="color: #0000ff;">null</span>) <span style="color: #0000ff;">return</span>;<br>            rectangle.Width = itemWidth;<br>        }<br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 设置选中背景的刷子<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”brush”&gt;&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> SetSelectedBackground(Brush brush)<br>        {<br>            <span style="color: #0000ff;">if</span> (rectangle == <span style="color: #0000ff;">null</span>) <span style="color: #0000ff;">return</span>;<br>            rectangle.Fill = brush;<br>        }<br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 设置选中的项目<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”index”&gt;</span><span style="color: #008000;">索引序号</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> SetSelectedIndex(<span style="color: #0000ff;">int</span> index)<br>        {<br>            <span style="color: #0000ff;">if</span> (rectangle == <span style="color: #0000ff;">null</span>) <span style="color: #0000ff;">return</span>;<br>            <span style="color: #0000ff;">if</span> (index &lt; <span style="color: #800080;">0</span> || index &gt; Items.Count) <span style="color: #0000ff;">return</span>;<br><br>            <span style="color: #0000ff;">double</span> x = SelectedWidth <em> index;<br>            <span style="color: #0000ff;">var</span> compositeTransform = (CompositeTransform)rectangle.RenderTransform;<br>            <span style="color: #0000ff;">if</span> (Math.Abs(compositeTransform.TranslateX - x) &gt; <span style="color: #800080;">1</span>)<br>                compositeTransform.TranslateX = SelectedWidth </em> index;<br>        }<br><br><span style="color: #0000ff;">#if</span> SILVERLIGHT<br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 重写鼠标左键放开事件<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”e”&gt;&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> OnMouseLeftButtonUp(MouseButtonEventArgs e)<br>        {<br>            Point point = e.GetPosition(<span style="color: #0000ff;">this</span>);<br>            <span style="color: #0000ff;">var</span> x = (<span style="color: #0000ff;">int</span>)(point.X / SelectedWidth) <em> SelectedWidth;<br>            <span style="color: #0000ff;">int</span> index = (<span style="color: #0000ff;">int</span>)(x / SelectedWidth);<br>            ShowAnimation(x);<br>            ChangeSelected(index);<br><br>            <span style="color: #0000ff;">base</span>.OnMouseLeftButtonUp(e);<br>        }<br><br><span style="color: #0000ff;">#else</span><br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 重写触摸点中事件<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”e”&gt;&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> OnTap(GestureEventArgs e)<br>        {<br>            Point point = e.GetPosition(<span style="color: #0000ff;">this</span>);<br><br>            <span style="color: #0000ff;">var</span> x = (<span style="color: #0000ff;">int</span>) (point.X/SelectedWidth)</em>SelectedWidth;<br>            <span style="color: #0000ff;">int</span> index = (<span style="color: #0000ff;">int</span>) (x/SelectedWidth);<br>            ShowAnimation(x);<br>            ChangeSelected(index);<br>            <span style="color: #0000ff;">base</span>.OnTap(e);<br>        }<br><span style="color: #0000ff;">#endif</span><br><br>        <span style="color: #808080;">///</span> <span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 选中后的动画<br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span> <span style="color: #808080;">&lt;param name=”x”&gt;&lt;/param&gt;</span><span style="color: #808080;"><br></span>        <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> ShowAnimation(<span style="color: #0000ff;">double</span> x)<br>        {<br>            <span style="color: #008000;">//</span><span style="color: #008000;">移动X坐标，并使用EasingFunction的弹簧特效</span><span style="color: #008000;"><br></span>            <span style="color: #0000ff;">var</span> animation = <span style="color: #0000ff;">new</span> DoubleAnimation<br>                                {<br>                                    Duration = <span style="color: #0000ff;">new</span> Duration(<span style="color: #0000ff;">new</span> TimeSpan(<span style="color: #800080;">0</span>, <span style="color: #800080;">0</span>, <span style="color: #800080;">0</span>, <span style="color: #800080;">0</span>, <span style="color: #800080;">500</span>)),<br>                                    To = x,<br>                                    EasingFunction =<br>                                        <span style="color: #0000ff;">new</span> ElasticEase { EasingMode = EasingMode.EaseOut, Oscillations = <span style="color: #800080;">1</span>, Springiness = <span style="color: #800080;">5</span> }<br>                                };<br>            Storyboard.SetTarget(animation, rectangle);<br>            Storyboard.SetTargetProperty(animation, <span style="color: #0000ff;">new</span> PropertyPath(<span style="color: #800000;">“</span><span style="color: #800000;">(UIElement.RenderTransform).(CompositeTransform.TranslateX)</span><span style="color: #800000;">“</span>));<br>            <span style="color: #0000ff;">var</span> storyboard = <span style="color: #0000ff;">new</span> Storyboard();<br>            storyboard.Children.Add(animation);<br>            storyboard.Begin();<br>        }<br>    }<br>}</pre><br></div><br></div>

<p>&nbsp;</p>
<p>对应的Generic.xaml</p>
<p>&nbsp;</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('64a5d21f-23e3-47e3-b075-41c8f087ccbb')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""><span class="cnblogs_code_collapse">View Code </span><br><div id="cnblogs_code_open_64a5d21f-23e3-47e3-b075-41c8f087ccbb" class="cnblogs_code_hide"><br><pre><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ResourceDictionary<br>    </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">=”<a href="http://schemas.microsoft.com/winfx/2006/xaml/presentation" target="_blank">http://schemas.microsoft.com/winfx/2006/xaml/presentation</a>“</span><span style="color: #ff0000;"><br>    xmlns:x</span><span style="color: #0000ff;">=”<a href="http://schemas.microsoft.com/winfx/2006/xaml" target="_blank">http://schemas.microsoft.com/winfx/2006/xaml</a>“</span><span style="color: #ff0000;"><br>    xmlns:local</span><span style="color: #0000ff;">=”clr-namespace:KiminozoStudio”</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Style </span><span style="color: #ff0000;">TargetType</span><span style="color: #0000ff;">=”local:TabSwitch”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”Width”</span><span style="color: #ff0000;"> Value</span><span style="color: #0000ff;">=”400”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”Height”</span><span style="color: #ff0000;"> Value</span><span style="color: #0000ff;">=”50”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”ItemsPanel”</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter.Value</span><span style="color: #0000ff;">&gt;</span><br>                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ItemsPanelTemplate</span><span style="color: #0000ff;">&gt;</span><br>                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">StackPanel </span><span style="color: #ff0000;">Orientation</span><span style="color: #0000ff;">=”Horizontal”</span> <span style="color: #0000ff;">/&gt;</span><br>                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ItemsPanelTemplate</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Setter.Value</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Setter</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”Template”</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter.Value</span><span style="color: #0000ff;">&gt;</span><br>                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ControlTemplate </span><span style="color: #ff0000;">TargetType</span><span style="color: #0000ff;">=”local:TabSwitch”</span><span style="color: #0000ff;">&gt;</span><br>                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #0000ff;">&gt;</span><br>                        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Rectangle </span><span style="color: #ff0000;">x:Name</span><span style="color: #0000ff;">=”rectangle”</span><span style="color: #ff0000;"> Width</span><span style="color: #0000ff;">=”65”</span><span style="color: #ff0000;"> Height</span><span style="color: #0000ff;">=”40”</span><span style="color: #ff0000;"> RadiusY</span><span style="color: #0000ff;">=”5”</span><span style="color: #ff0000;"> RadiusX</span><span style="color: #0000ff;">=”5”</span><span style="color: #ff0000;"><br>                                Fill</span><span style="color: #0000ff;">=”Red”</span><span style="color: #ff0000;"> HorizontalAlignment</span><span style="color: #0000ff;">=”Left”</span><span style="color: #0000ff;">&gt;</span><br>                            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Rectangle.RenderTransform</span><span style="color: #0000ff;">&gt;</span><br>                                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">CompositeTransform</span><span style="color: #0000ff;">/&gt;</span><br>                            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Rectangle.RenderTransform</span><span style="color: #0000ff;">&gt;</span><br>                        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Rectangle</span><span style="color: #0000ff;">&gt;</span><br>                        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ItemsPresenter</span><span style="color: #0000ff;">/&gt;</span><br>                    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000ff;">&gt;</span><br>                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ControlTemplate</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Setter.Value</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Setter</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Style</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Style </span><span style="color: #ff0000;">TargetType</span><span style="color: #0000ff;">=”local:TabSwitchItem”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”Width”</span><span style="color: #ff0000;"> Value</span><span style="color: #0000ff;">=”65”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”Height”</span><span style="color: #ff0000;"> Value</span><span style="color: #0000ff;">=”40”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”Margin”</span><span style="color: #ff0000;"> Value</span><span style="color: #0000ff;">=”0,10,0,3”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter </span><span style="color: #ff0000;">Property</span><span style="color: #0000ff;">=”Template”</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Setter.Value</span><span style="color: #0000ff;">&gt;</span><br>                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ControlTemplate </span><span style="color: #ff0000;">TargetType</span><span style="color: #0000ff;">=”local:TabSwitchItem”</span><span style="color: #0000ff;">&gt;</span><br>                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">TextBlock </span><span style="color: #ff0000;">Text</span><span style="color: #0000ff;">=”</span><span style="color: #808000;">{TemplateBinding Content}</span><span style="color: #0000ff;">“</span><span style="color: #ff0000;"> TextAlignment</span><span style="color: #0000ff;">=”Center”</span> <span style="color: #0000ff;">/&gt;</span><br>                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ControlTemplate</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Setter.Value</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Setter</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Style</span><span style="color: #0000ff;">&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ResourceDictionary</span><span style="color: #0000ff;">&gt;</span></pre><br></div><br></div>

<p>&nbsp;</p>
<p>测试代码：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my:TabSwitch </span><span style="color: #ff0000;">Height</span><span style="color: #0000ff;">=”56”</span><span style="color: #ff0000;"> HorizontalAlignment</span><span style="color: #0000ff;">=”Left”</span><span style="color: #ff0000;"> Margin</span><span style="color: #0000ff;">=”52,21,0,0”</span><span style="color: #ff0000;"> x:Name</span><span style="color: #0000ff;">=”tabSwitch1”</span><span style="color: #ff0000;"> VerticalAlignment</span><span style="color: #0000ff;">=”Top”</span><span style="color: #ff0000;"> Width</span><span style="color: #0000ff;">=”349”</span><span style="color: #ff0000;"> d:IsHidden</span><span style="color: #0000ff;">=”True”</span><span style="color: #ff0000;"> FontSize</span><span style="color: #0000ff;">=”16”</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my:TabSwitchItem </span><span style="color: #ff0000;">Content</span><span style="color: #0000ff;">=”选项1”</span><span style="color: #0000ff;">/&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my:TabSwitchItem </span><span style="color: #ff0000;">Content</span><span style="color: #0000ff;">=”选项2”</span><span style="color: #0000ff;">/&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my:TabSwitchItem </span><span style="color: #ff0000;">Content</span><span style="color: #0000ff;">=”选项3”</span><span style="color: #0000ff;">/&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my:TabSwitchItem </span><span style="color: #ff0000;">Content</span><span style="color: #0000ff;">=”选项4”</span><span style="color: #0000ff;">/&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my:TabSwitchItem </span><span style="color: #ff0000;">Content</span><span style="color: #0000ff;">=”选项5”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">my:TabSwitch</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>

    
  </div>
  <footer>
    
      
  
  <div class="categories">
    <a href="/categories/未分类/">未分类</a>
  </div>

      
    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <div class="widget-wrapper">
    <aside id="sidebar">
  
  
    
      
      

<div class="widget tag first">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/未分类/">未分类</a><small>67</small></li>
  
  </ul>
</div>

    
      
      
    
      
      
    
      
      

<div class="widget recent-posts">
  <h3 class="title">最近的文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/03/19/hello-world/">Hello World</a>
      </li>
    
      <li>
        <a href="/2012/11/02/windows-phone-toolkit-for-wp8-已经出了/">Windows Phone Toolkit for WP8 已经出了</a>
      </li>
    
      <li>
        <a href="/2012/06/17/代码分享-scrollviewerlistener-获取scrollviewer的位置改变/">代码分享 ScrollViewerListener 获取ScrollViewer的位置改变</a>
      </li>
    
      <li>
        <a href="/2012/04/18/经验-c手动同步的滥用实例/">经验 C#手动同步的滥用实例</a>
      </li>
    
      <li>
        <a href="/2012/04/06/wp7技巧-扩展【共享-】按钮/">WP7技巧 扩展【共享...】按钮</a>
      </li>
    
  </ul>
</div>

    
      
      

<div class="widget blogroll">
  <h3 class="title">友情链接</h3>
  <ul class="entry">
  
    
    <li><a href="http://heroicyang.com/" target="_blank">Heroic Yang&#39;s Blog</a></li>
  
  </ul>
</div>

    
  
</aside>
<div class="clearfix"></div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2014 <a href="/">kiminozo</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>